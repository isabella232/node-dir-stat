{"version":3,"sources":["httprequestpool.js","package-graph.js","graphviz.js","index.js"],"names":["RequestPool","capacity","retries","this","size","jobs","doneListeners","progressListeners","url","options","a","i","fetch","Promise","resolve","setTimeout","listener","_tryDequeue","length","pop","reject","_fetchWithRetry","catch","e","_onJobDone","then","res","push","event","iteratePackages","packages","callback","Object","keys","forEach","name","dependencies","iterateChildren","node","seen","children","child","totalDirSize","files","map","reduce","b","setSizes","nodes","statusCallback","requestPool","numProcessed","version","err","json","meta","values","packageParents","Map","packageName","packageData","set","Set","requires","childName","get","add","totalNumParents","allParents","recurse","has","nodesList","sort","totalSize","seenNodes","result","GraphVizRow","sizeBytes","number","height","setCurrNode","className","style","display","flexWrap","justifyContent","alignItems","minWidth","textAlign","background","cursor","onClick","margin","marginTop","toFixed","GraphVizColumns","graph","graphList","sqrtNumNodes","Math","ceil","sqrt","groups","Array","fill","_","slice","overflowX","flexDirection","group","groupIndex","alignContent","minHeight","maxHeight","width","maxWidth","Breadcrumb","elements","href","preventDefault","GraphViz","React","useState","currGraph","setCurrGraph","useEffect","breadcrumbElements","setBreadcrumbElements","index","findIndex","App","inputRef","setInputRef","packageLockJson","setPackageLockJson","error","setError","setGraph","status","setStatus","lockfileVersion","ParseGraph","percent","click","fontSize","type","accept","visibility","ref","onChange","target","reader","FileReader","onload","JSON","parse","readAsBinaryString","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.95cd35c1.chunk.js","sourcesContent":["export default class RequestPool {\n    constructor({capacity, retries}) {\n        this.size = 0;\n        this.capacity = capacity || 5;\n        this.retries = retries || 5;\n        this.jobs = [];\n        this.doneListeners = [];\n        this.progressListeners = [];\n    }\n\n    async _fetchWithRetry(url, options) {\n        for (let i = 0; i < this.retries; i++) {\n            try {\n                return await fetch(url, options);\n            } catch (e) {\n                if (i === this.retries - 1) {\n                    throw e;\n                }\n                await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1) * (i + 1))); //n^2 backoff\n            }\n        }\n    }\n\n    _onJobDone() {\n        this.size -= 1;\n        if (this.size === 0) {\n            for (let listener of this.doneListeners) {\n                listener();\n            }\n            this.doneListeners = [];\n        } else {\n            this._tryDequeue();\n        }\n        for (let listener of this.progressListeners) {\n            listener();\n        }\n    }\n\n    _tryDequeue() {\n        if (this.size >= this.capacity) {\n            return;\n        }\n        if (this.jobs.length === 0) {\n            return;\n        }\n        const {url, options, resolve, reject} = this.jobs.pop();\n        this.size += 1;\n        this._fetchWithRetry(url, options).catch(e => {\n            reject(e);\n            this._onJobDone();\n        }).then(res => {\n            resolve(res);\n            this._onJobDone();\n        });\n    }\n\n    fetch(url, options) {\n        return new Promise((resolve, reject) => {\n            this.jobs.push({url, options, resolve, reject});\n            this._tryDequeue();\n        });\n    }\n\n    on(event, listener) {\n        if (event === 'progress') {\n            this.progressListeners.push(listener);\n        }\n    }\n\n    wait() {\n        return new Promise(resolve => {\n            this.doneListeners.push(resolve);\n        });\n    }\n}\n","import RequestPool from \"./httprequestpool\";\n\nfunction iteratePackages(packages, callback) {\n    Object.keys(packages).forEach(name => {\n        callback(name, packages[name]);\n        iteratePackages(packages[name].dependencies || {}, callback);\n    })\n}\n\nfunction iterateChildren(node, callback, seen) {\n    if (!node || !node.children) {\n        return;\n    }\n    seen = seen || {};\n    if (seen[node.name]) {\n        return;\n    }\n    seen[node.name] = true;\n    callback(node);\n\n    node.children.forEach(child => {\n        iterateChildren(child, callback, seen);\n    })\n}\n\nconst totalDirSize = (files) => {\n    if (!files) {\n        return 0;\n    }\n    return files.map(({size, files}) => (size || 0) + totalDirSize(files)).reduce((a, b) => a + b, 0);\n}\n\nfunction setSizes(nodes, statusCallback) {\n    const requestPool = new RequestPool({capacity: 10, retries: 5});\n    let numProcessed = 0;\n\n    return new Promise((resolve, reject) => {\n        for (let node of Object.values(nodes)) {\n            // node.size = Math.ceil(Math.random()*10000+1); statusCallback(100); continue;\n\n            requestPool.fetch(\"https://unpkg.com/\" + node.name + \"@\" + node.version + \"/?meta\")\n                .catch(err => {\n                    reject(\"Error for \" + node.name + \": \" + err);\n                })\n                .then(res => res.json())\n                .then(meta => {\n                    node.size = totalDirSize(meta.files);\n                    numProcessed += 1;\n                    statusCallback(numProcessed * 100/Object.values(nodes).length);\n                    if(numProcessed === Object.values(nodes).length) {\n                        resolve(null);\n                    }\n                })\n        }\n    });\n}\n\nexport async function ParseGraph(packages, statusCallback) {\n    const packageParents = new Map();\n    const nodes = {};\n\n    iteratePackages(packages, (packageName, packageData) => {\n        packageParents.set(packageName, new Set());\n        nodes[packageName] = {\n            name: packageName,\n            version: packageData.version,\n            children: new Set(),\n        };\n    });\n\n    iteratePackages(packages, (packageName, packageData) => {\n        for (let childName of Object.keys(packageData.requires || {})) {\n            packageParents.get(childName).add(packageName);\n            nodes[packageName].children.add(nodes[childName]);\n        }\n        for (let childName of Object.keys(packageData.dependencies || {})) {\n            packageParents.get(childName).add(packageName);\n            nodes[packageName].children.add(nodes[childName]);\n        }\n    });\n\n    await setSizes(nodes, statusCallback);\n\n    const totalNumParents = packageName => {\n        const allParents = new Set();\n        const recurse = nodes => {\n            for (let node of nodes) {\n                if (!allParents.has(node)) {\n                    allParents.add(node);\n                    recurse(packageParents.get(node));\n                }\n            }\n        }\n        recurse(packageParents.get(packageName));\n        return allParents.size;\n    }\n\n    //sort by closure size - there might be loops so can't do a topological sort\n    const nodesList = Object.values(nodes);\n    nodesList.sort((a, b) => totalNumParents(a.name) - totalNumParents(b.name));\n    for (let node of nodesList) {\n        node.totalSize = node.size;\n        iterateChildren(node, child => node.totalSize += child.size);\n    }\n\n    const seenNodes = {};\n    const result = [];\n    for (let node of nodesList) {\n        if (!seenNodes[node.name]) {\n            result.push(node);\n        }\n        iterateChildren(node, child => seenNodes[child.name] = true);\n    }\n    return result;\n}","import React from \"react\";\n\nfunction selectColor(number) {\n    const hue = number * 137.508; // use golden angle approximation\n    return `hsl(${hue},50%,75%)`;\n}\n\nfunction renderFileSize(sizeBytes) {\n    if (sizeBytes < 1_000) {\n        return sizeBytes + \"B\";\n    }\n    if (sizeBytes < 1_000_000) {\n        return (sizeBytes / 1_000).toFixed(1) + \"kB\";\n    }\n    if (sizeBytes < 1_000_000_000) {\n        return (sizeBytes / 1_000_000).toFixed(1) + \"MB\";\n    }\n    return (sizeBytes / 1_000_000_000).toFixed(2) + \"GB\";\n}\n\nfunction GraphVizRow({node, i, height, setCurrNode}) {\n    return <div\n        className=\"graphbox\"\n        style={{\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            height: (height * 95) + \"vh\",\n            minWidth: \"8rem\",\n            textAlign: \"center\",\n            background: selectColor(i),\n            cursor: node.children.size > 0 ? \"pointer\" : \"inherit\",\n        }}\n        onClick={() => {\n            if (node.children.size === 0) {\n                return;\n            }\n            setCurrNode(node)\n        }}\n    >\n        <div>\n            <h5 style={{margin: 0}}>{node.name}</h5>\n            <h5 style={{marginTop: \".25rem\"}}>({renderFileSize(node.totalSize) + \", \" + (node.children.size > 0 ? node.children.size : \"no\")} children)</h5>\n        </div>\n    </div>\n}\n\nfunction GraphVizColumns({graph, setCurrNode}) {\n    const graphList = [...graph];\n    const sqrtNumNodes = Math.ceil(Math.sqrt(graphList.length));\n    if(sqrtNumNodes === 0) {\n        return <div>No nodes.</div>\n    }\n    const groups = new Array(sqrtNumNodes)\n        .fill(null)\n        .map((_, i) => graphList.slice(sqrtNumNodes * i, sqrtNumNodes * (i+1)));\n\n    return <div style={{overflowX: \"auto\", display: \"flex\", flexDirection: \"row\"}}>\n        {groups.map((group, groupIndex) => <div key={groupIndex} style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            alignContent: \"flex-start\",\n            minHeight: \"50vh\",\n            maxHeight: \"calc(95vh + 2px)\",\n            width: ( group.map(({totalSize}) => totalSize).reduce((a, b) => a + b, 0) * 100\n                / graphList.map(({totalSize}) => totalSize).reduce((a, b) => a + b, 0))+\"%\",\n            maxWidth: \"50%\",\n        }}>\n            {group.map((node, i) => <GraphVizRow\n                key={node.name}\n                node={node}\n                i={i}\n                setCurrNode={setCurrNode}\n                height={node.totalSize / group.map(({totalSize}) => totalSize).reduce((a, b) => a + b, 0)}\n            />)}\n        </div>)}\n    </div>\n}\n\nfunction Breadcrumb({elements, onClick}) {\n    return <div style={{display: \"flex\", flexDirection: \"row\", margin: \"1rem\"}}>\n        {[...elements].map((node, i) => <span key={node.name}>\n            {i !== 0 ? <i className=\"feather icon-chevron-right\" style={{margin: \"0 0.5rem\"}}/> : null}\n            <a href=\"#\" onClick={e => {\n                e.preventDefault();\n                onClick(node);\n            }}>{node.name}</a>\n        </span>)}\n    </div>\n}\n\nexport function GraphViz({graph}) {\n    const [currGraph, setCurrGraph] = React.useState(graph);\n    React.useEffect(() => {\n        if (!currGraph) {\n            setCurrGraph(graph);\n        }\n    }, [graph]);\n\n    const [breadcrumbElements, setBreadcrumbElements] = React.useState([{name: \"(root)\", children: graph}]);\n\n    return <div style={{display: \"flex\", flexDirection: \"column\"}}>\n        <Breadcrumb\n            elements={breadcrumbElements}\n            onClick={node => {\n                const index = breadcrumbElements.findIndex(({name}) => name === node.name);\n                if (index >= 0) {\n                    setBreadcrumbElements(breadcrumbElements.slice(0, index + 1));\n                }\n                setCurrGraph(node.children);\n            }}\n        />\n        <GraphVizColumns graph={currGraph} setCurrNode={node => {\n            setCurrGraph([...node.children]);\n            breadcrumbElements.push(node);\n        }}/>\n    </div>\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {ParseGraph} from \"./package-graph\";\nimport {GraphViz} from \"./graphviz\";\n\nconst App = () => {\n    const [inputRef, setInputRef] = React.useState(null);\n    const [packageLockJson, setPackageLockJson] = React.useState(null);\n    const [error, setError] = React.useState(null);\n    const [graph, setGraph] = React.useState(null);\n    const [status, setStatus] = React.useState(\"Initializing...\");\n\n    React.useEffect(() => {\n        if (packageLockJson && packageLockJson.lockfileVersion !== 1) {\n            setError(\"Invalid lockfile - we expect 'lockfileVersion=1' from package-lock-old.json\");\n            return;\n        }\n        if(packageLockJson) {\n            ParseGraph(packageLockJson.dependencies, percent => {\n                setStatus(\"Setting sizes (\" + percent.toFixed(1) + \"%)\");\n            }).catch(e => setError(\"\" + e))\n                .then(res => {\n                    if (res) {\n                        setGraph(res);\n                    }\n                })\n        }\n    }, [packageLockJson]);\n\n    return <main style={{display: \"flex\", flexDirection: \"column\"}}>\n        {packageLockJson ? null : <>\n            <div>\n                <button className=\"upload-file-button\" onClick={() => inputRef.click()}>\n                    <i className=\"feather icon-play-circle\"\n                       style={{fontSize: \"0.85rem\", display: \"inline-block\"}}/> Upload a package-lock.json file\n                </button>\n            </div>\n            <input type=\"file\" accept=\".json\" style={{visibility: \"hidden\"}} ref={setInputRef} onChange={e => {\n                if (e.target && e.target.files && e.target.files[0]) {\n                    const reader = new FileReader();\n                    reader.onload = e => {\n                        try {\n                            setPackageLockJson(JSON.parse(e.target.result));\n                        } catch (e) {\n                            setError(\"Could not load package lock json: \" + e);\n                        }\n                    }\n                    reader.readAsBinaryString(e.target.files[0]);\n                }\n            }}/>\n        </>}\n        {packageLockJson && !graph\n            ? <div style={{\n                minHeight: \"10rem\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                flexDirection: \"column\"\n            }}>\n                <h5>Pulling package size data from unpkg.com...</h5>\n                <div>\n                    {status}\n                </div>\n            </div>\n            : null\n        }\n        {error ? <div className=\"error\">Error: {error}</div> : null}\n        {graph ? <GraphViz graph={graph}/> : null}\n    </main>\n}\n\nReactDOM.render(\n    <React.StrictMode>\n        <App/>\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n"],"sourceRoot":""}